<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">


<head>
<title>게시글 상세</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<body th:align="center">
	<h1>게시글 상세</h1>
	<form th:action="@{/board/updateBoard}" method="post">
<!-- 	<input type="hidden" name="member" th:value="${board.member}" /> -->
		<table th:align="center" border="1" th:cellpadding="0"
			th:cellspacing="0">
			<tr>
				<td bgcolor="orange" th:text="제목" width="80"></td>
				<td><input name="seq" type="hidden" th:value="${board.seq}">
					<input name="title" type="text" th:value="${board.title}"></td>
			</tr>
			<tr>
				<td bgcolor="orange" th:text="작성자"></td>
				<td><input readonly="readonly" name="name" th:value="${board.member.name}"></td>
			</tr>
			<tr><!-- 작성자 아니면 수정 못하고 튕김 ㅅㄱ  -->
				<td bgcolor="orange" th:text="내용">
				<td><textarea  name="content" th:text="${board.content}"
						cols="40" rows="10"></textarea></td>
			</tr>
			<tr>
				<td bgcolor="orange" th:text="등록일"></td>
				<td th:text="${#dates.format(board.createDate, 'yyyy-MM-dd')}">
			</tr>
			<tr>
				<td bgcolor="orange" th:text="조회수"></td>
				<td th:text="${board.cnt}"></td>
			</tr>
			<tr th:if="${board.member.name}==${visitor.name}">
				<td colspan="2" align="center"><input type="submit"
					value="게시글 수정"></td>
			</tr>

		</table>
	</form>
	<!-- 파일이미지 -->
	<h3>이미지 출력</h3>
      <div style="text-align: center;">
      <div th:each="imageFile : ${fileList} " style="float:left -100px; margin: auto; display: inline-block; ">    
         <img th:src=" |/board/images/${imageFile.fileId}|"  width="150" height="150" style="text-align: center;">
         <p th:text="${imageFile.orgNm}"></p>
         <a th:if="${board.member.name}==${visitor.name}" th:href="@{/board/images/deleteFile(fileId=${imageFile.fileId},seq=${board.seq})}" th:text="x"> </a>
         <a sec:authorize="hasRole('ROLE_ADMIN')"
		th:if="${board.member.name}!=${visitor.name}" th:href="@{/board/images/deleteFile(fileId=${imageFile.fileId},seq=${board.seq})}" th:text="${'Admin Delete'}"> </a>
      </div>   
      </div>
	<!-- 파일이미지 -->
	<!-- 파일다운 -->
	<div style="clear: both;">
      <h4>파일 다운로드</h4>
      <div th:each="file : ${fileList}">
            <a th:href="|/board/attach/${file.fileId}|" th:text="${file.orgNm}"></a>
      </div>
      </div>
	<!-- 파일다운 -->

	<table th:align="center" border="1" th:cellpadding="0"
		th:cellspacing="0">
		<tr>
			<td bgcolor="green" th:text="${'댓글 번호'}" width="80"></td>
			<td bgcolor="green" th:text="${'작성자'}" width="80"></td>
			<td bgcolor="green" th:text="${'내용'}" width="80"></td>
			<td bgcolor="green" th:text="${'작성 일시'}"></td>
			<td bgcolor="green" th:text="${'수정'}"></td>
			<td bgcolor="green" th:text="${'삭제'}"></td>
		</tr>
		<tr th:each="rep,state : ${replyList}">
			<td th:text="${state.count}"></td>
			<td th:text="${rep.member.name}" width="80"></td>
			<td th:text="${rep.comments}"></td>
			<td th:text="${#dates.format(rep.regDate, 'yyyy-MM-dd')}"></td>
			<td bgcolor="green"><a
				th:if="${rep.member.name}==${visitor.name}"
				th:href="@{/board/updateReply(rid=${rep.rid})}" th:text="'댓글 수정'"></a>
			</td>
			<td bgcolor="green"><a sec:authorize="hasRole('ROLE_ADMIN')"
				th:if="${rep.member.name}!=${visitor.name}"
				th:href="@{/board/deleteReply(rid=${rep.rid})}"
				th:text="'댓글 삭제(관리자)'"></a> 
				<a
				th:if="${rep.member.name}==${visitor.name}"
				th:href="@{/board/deleteReply(rid=${rep.rid})}" th:text="'댓글 삭제'"></a>
			</td>
		</tr>
		<tr>
			<td
				th:each="page : ${#numbers.sequence(0, searchResult.getReplyPage() - 1)}">
				<a
				th:href="@{/board/getBoard(
				replyPage=${pageStat.index},
				seq=${board.seq}
				)
				}"
				th:text="${pageStat.index + 1}"> </a>
			</td>

		</tr>
	</table>

	<form th:action="@{/board/insertReply}" method="post">
		<input type="hidden" th:value="${visitor.id}" name="id" /> <input
			type="hidden" th:value="${board.seq}" name="seq" />
		<table th:align="center" border="1" th:cellpadding="0"
			th:cellspacing="0">
			<tr>
				<td bgcolor="grey" th:text="${'댓글 작성'}"></td>
				<td><input name="comments" /></td>
			</tr>
			<tr>
				<td bgcolor="green" th:text="작성자"></td>
				<td readonly="readonly" name="name" th:text="${visitor.name}"></td>
			</tr>
			<tr>
				<td colspan="2" align="center"><input type="submit"
					value="댓글 등록"></td>
			</tr>
		</table>
	</form>
	<div style="margin-top: 50px">
      <form th:action="@{/mail}" method="post">
         <input type="hidden" name="title" th:value="${board.title}" />
         <input type="hidden" name="message" th:value="${board.content}" />
         <input name="toAddress" placeholder="전송 받을 이메일 주소" />&nbsp;
         <!-- 메일 디티오 이름 바꾸주고 여기 이름 은 그대로 둬서 오류뜸 -->
         <!-- 여기에 첨부파일 넣어줘야함  -->
         <input type="hidden" th:each=" file : ${fileList}" name="attachFileList" th:value="${file.savedPath}"/>
         <button>발송</button>
      </form>
   </div>
	
	<a th:href="@{/board/insertBoard}">글등록</a>&nbsp;&nbsp;&nbsp;
	<a sec:authorize="hasRole('ROLE_ADMIN')"
		th:if="${board.member.name}!=${visitor.name}"
		th:href="@{/board/deleteBoard(seq=${board.seq})}">글 삭제(관리자)</a>&nbsp;&nbsp;&nbsp;
	<a th:if="${board.member.name}==${visitor.name}"
		th:href="@{/board/deleteBoard(seq=${board.seq})}">글 삭제</a>&nbsp;&nbsp;&nbsp;
	<a th:href="@{/board/getBoardList}">글목록</a>
</body>
</html>
